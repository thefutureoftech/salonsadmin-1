{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PlaceEditComponent = void 0;\n\nconst tslib_1 = require(\"tslib\");\n\nconst places_dbservice_1 = require(\"../../services/places.dbservice\");\n\nconst router_1 = require(\"@angular/router\");\n\nconst i0 = (0, tslib_1.__importStar)(require(\"@angular/core\"));\nconst i1 = (0, tslib_1.__importStar)(require(\"../../services/places.dbservice\"));\nconst i2 = (0, tslib_1.__importStar)(require(\"@angular/router\"));\nconst i3 = (0, tslib_1.__importStar)(require(\"@mobiscroll/angular\"));\nconst i4 = (0, tslib_1.__importStar)(require(\"@angular/forms\"));\nconst i5 = (0, tslib_1.__importStar)(require(\"@angular/common\"));\n\nfunction PlaceEditComponent_h3_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h3\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"New \", ctx_r1.type, \"\");\n  }\n}\n\nfunction PlaceEditComponent_h3_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h3\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Edit \", ctx_r2.type, \"\");\n  }\n}\n\nfunction PlaceEditComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"mbsc-input\", 10);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_5_Template_mbsc_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.country.name = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mbsc-input\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_5_Template_mbsc_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.country.arabicName = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mbsc-input\", 12);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_5_Template_mbsc_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.country.code = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mbsc-input\", 13);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_5_Template_mbsc_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.country.currency = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mbsc-input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_5_Template_mbsc_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.country.exRate = $event;\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.country.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.country.arabicName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.country.code);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.country.currency);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.country.exRate);\n  }\n}\n\nfunction PlaceEditComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"mbsc-input\", 10);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_6_Template_mbsc_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.state.name = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mbsc-input\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_6_Template_mbsc_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.state.arabicName = $event;\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.state.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.state.arabicName);\n  }\n}\n\nfunction PlaceEditComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"mbsc-input\", 10);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_7_Template_mbsc_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.city.name = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mbsc-input\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_7_Template_mbsc_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.city.arabicName = $event;\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r5.city.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r5.city.arabicName);\n  }\n}\n\nfunction PlaceEditComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"mbsc-input\", 10);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_8_Template_mbsc_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return ctx_r19.town.name = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mbsc-input\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function PlaceEditComponent_div_8_Template_mbsc_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.town.arabicName = $event;\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r6.town.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r6.town.arabicName);\n  }\n}\n\nclass PlaceEditComponent {\n  constructor(placesDBService, router, activeRoute) {\n    this.placesDBService = placesDBService;\n    this.router = router;\n    this.activeRoute = activeRoute;\n    this.editMode = false;\n    this.formSettings = {\n      theme: 'ios'\n    };\n  }\n\n  ngOnInit() {\n    this.activeRoute.queryParams.subscribe(params => {\n      if (params.id != undefined) {\n        if (params.type === 'Country') {\n          if (!this.placesDBService.getCountries()) {\n            this.router.navigate(['../../countries'], {\n              relativeTo: this.activeRoute\n            });\n            return;\n          }\n\n          this.country = this.placesDBService.getCountry(params.id);\n          this.type = params.type;\n          this.editMode = true;\n        } else if (params.type === 'State') {\n          if (!this.placesDBService.getStates()) {\n            this.router.navigate(['../../states'], {\n              relativeTo: this.activeRoute\n            });\n            return;\n          }\n\n          this.state = this.placesDBService.getState(params.id);\n          this.type = params.type;\n          this.editMode = true;\n        } else if (params.type === 'City') {\n          if (!this.placesDBService.getCities()) {\n            this.router.navigate(['../../cities'], {\n              relativeTo: this.activeRoute\n            });\n            return;\n          }\n\n          this.city = this.placesDBService.getCity(params.id);\n          this.type = params.type;\n          this.editMode = true;\n        } else if (params.type === 'Town') {\n          if (!this.placesDBService.getTowns()) {\n            this.router.navigate(['../../towns'], {\n              relativeTo: this.activeRoute\n            });\n            return;\n          }\n\n          this.town = this.placesDBService.getTown(params.id);\n          this.type = params.type;\n          this.editMode = true;\n        }\n      } else if (params.type.length > 0) {\n        this.type = params.type;\n        this.editMode = false;\n      } else {\n        this.type = '';\n        this.editMode = false;\n      }\n\n      if (this.editMode) {\n        this.childrenExist();\n      } else {\n        if (this.type === 'Country') {\n          this.country = {\n            name: '',\n            arabicName: '',\n            currency: '',\n            exRate: 0,\n            code: ''\n          };\n        } else if (this.type === 'State') {\n          this.state = {\n            name: '',\n            arabicName: '',\n            parent: this.placesDBService.getSelectedCountry().id\n          };\n        } else if (this.type === 'City') {\n          this.city = {\n            name: '',\n            arabicName: '',\n            parent: this.placesDBService.getSelectedState().id\n          };\n        } else if (this.type === 'Town') {\n          this.town = {\n            name: '',\n            arabicName: '',\n            parent: this.placesDBService.getSelectedCity().id\n          };\n        }\n\n        this.cancelDelete = 'Cancel';\n      }\n    });\n  }\n\n  childrenExist() {\n    if (this.type === 'Country') {\n      this.placesDBService.canDeleteCountry(this.country.id).subscribe(states => {\n        states.forEach(state => {\n          if (state.parent === this.country.id) {\n            this.cancelDelete = 'Cancel';\n          }\n        });\n\n        if (this.cancelDelete != 'Cancel') {\n          this.cancelDelete = 'Delete';\n        }\n      });\n    } else if (this.type === 'State') {\n      this.placesDBService.canDeleteState(this.state.id).subscribe(cities => {\n        if (cities.length > 0) {\n          this.cancelDelete = 'Cancel';\n        } else {\n          this.cancelDelete = 'Delete';\n        }\n      });\n    } else if (this.type === 'City') {\n      this.placesDBService.canDeleteCity(this.city.id).subscribe(town => {\n        if (town.length > 0) {\n          this.cancelDelete = 'Cancel';\n        } else {\n          this.cancelDelete = 'Delete';\n        }\n      });\n    } else if (this.type === 'Town') {\n      let can = this.placesDBService.canDeleteTown(this.town.id);\n\n      if (can) {\n        this.cancelDelete = 'Delete';\n      }\n    }\n  }\n\n  proceed(form) {\n    if (this.type === 'Country') {\n      if (this.editMode) {\n        this.placesDBService.saveCountry(this.country.id, this.country);\n      } else {\n        this.placesDBService.createCountry(this.country);\n      }\n\n      this.placesDBService.setSelectedCountry(null);\n      this.router.navigate(['../../countries'], {\n        relativeTo: this.activeRoute\n      });\n    } else if (this.type === 'State') {\n      if (this.editMode) {\n        this.placesDBService.saveState(this.state.id, this.state);\n      } else {\n        this.placesDBService.createState(this.state);\n      }\n\n      this.placesDBService.setSelectedState(null);\n      this.router.navigate(['../../states'], {\n        relativeTo: this.activeRoute\n      });\n    } else if (this.type === 'City') {\n      if (this.editMode) {\n        this.placesDBService.saveCity(this.city.id, this.city);\n      } else {\n        this.placesDBService.createCity(this.city);\n      }\n\n      this.placesDBService.setSelectedCity(null);\n      this.router.navigate(['../../cities'], {\n        relativeTo: this.activeRoute\n      });\n    } else if (this.type === 'Town') {\n      if (this.editMode) {\n        this.placesDBService.saveTown(this.town.id, this.town);\n      } else {\n        this.placesDBService.createTown(this.town);\n      }\n\n      this.placesDBService.setSelectedTown(null);\n      this.router.navigate(['../../towns'], {\n        relativeTo: this.activeRoute\n      });\n    }\n  }\n\n  cancelOrDelete() {\n    if (this.type === 'Country') {\n      if (this.cancelDelete === 'Cancel') {\n        this.router.navigate(['../../countries'], {\n          relativeTo: this.activeRoute\n        });\n      } else if (this.cancelDelete === 'Delete') {\n        this.placesDBService.deleteCountry(this.country.id);\n        this.router.navigate(['../../countries'], {\n          relativeTo: this.activeRoute\n        });\n      }\n\n      this.placesDBService.setSelectedCountry(null);\n    } else if (this.type === 'State') {\n      if (this.cancelDelete === 'Cancel') {\n        this.router.navigate(['../../states'], {\n          relativeTo: this.activeRoute\n        });\n      } else if (this.cancelDelete === 'Delete') {\n        this.placesDBService.deleteState(this.state.id);\n        this.router.navigate(['../../states'], {\n          relativeTo: this.activeRoute\n        });\n      }\n\n      this.placesDBService.setSelectedState(null);\n    } else if (this.type === 'City') {\n      if (this.cancelDelete === 'Cancel') {\n        this.router.navigate(['../../cities'], {\n          relativeTo: this.activeRoute\n        });\n      } else if (this.cancelDelete === 'Delete') {\n        this.placesDBService.deleteCity(this.city.id);\n        this.router.navigate(['../../cities'], {\n          relativeTo: this.activeRoute\n        });\n      }\n\n      this.placesDBService.setSelectedCity(null);\n    } else if (this.type === 'Town') {\n      if (this.cancelDelete === 'Cancel') {\n        this.router.navigate(['../../towns'], {\n          relativeTo: this.activeRoute\n        });\n      } else if (this.cancelDelete === 'Delete') {\n        this.placesDBService.deleteTown(this.city.id);\n        this.router.navigate(['../../towns'], {\n          relativeTo: this.activeRoute\n        });\n      }\n\n      this.placesDBService.setSelectedTown(null);\n    }\n  }\n\n}\n\nexports.PlaceEditComponent = PlaceEditComponent;\n\nPlaceEditComponent.ɵfac = function PlaceEditComponent_Factory(t) {\n  return new (t || PlaceEditComponent)(i0.ɵɵdirectiveInject(i1.PlacesDBService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\n\nPlaceEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PlaceEditComponent,\n  selectors: [[\"app-place-edit\"]],\n  decls: 15,\n  vars: 9,\n  consts: [[1, \"md-create-account\", 3, \"options\"], [\"novalidate\", \"\", 3, \"ngSubmit\"], [\"frm\", \"ngForm\"], [\"style\", \"text-align: center\", 4, \"ngIf\"], [\"class\", \"md-cac-cont\", 4, \"ngIf\"], [1, \"mbsc-btn-group-justified\"], [\"type\", \"submit\", 2, \"display\", \"block\", 3, \"disabled\"], [\"type\", \"button\", 3, \"click\"], [2, \"text-align\", \"center\"], [1, \"md-cac-cont\"], [\"id\", \"name\", \"name\", \"name\", \"type\", \"text\", \"placeholder\", \"Name\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"arabicName\", \"name\", \"arabicName\", \"type\", \"text\", \"placeholder\", \"Arabic Name\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"code\", \"name\", \"code\", \"type\", \"text\", \"placeholder\", \"Country Code\", 3, \"ngModel\", \"ngModelChange\"], [\"id\", \"currency\", \"name\", \"currency\", \"type\", \"text\", \"placeholder\", \"Country Currency\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"number\", \"name\", \"rate\", \"id\", \"rate\", \"placeholder\", \"Country Rate\", 3, \"ngModel\", \"ngModelChange\"]],\n  template: function PlaceEditComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      const _r22 = i0.ɵɵgetCurrentView();\n\n      i0.ɵɵelementStart(0, \"mbsc-form\", 0)(1, \"form\", 1, 2);\n      i0.ɵɵlistener(\"ngSubmit\", function PlaceEditComponent_Template_form_ngSubmit_1_listener() {\n        i0.ɵɵrestoreView(_r22);\n\n        const _r0 = i0.ɵɵreference(2);\n\n        return ctx.proceed(_r0);\n      });\n      i0.ɵɵtemplate(3, PlaceEditComponent_h3_3_Template, 2, 1, \"h3\", 3);\n      i0.ɵɵtemplate(4, PlaceEditComponent_h3_4_Template, 2, 1, \"h3\", 3);\n      i0.ɵɵtemplate(5, PlaceEditComponent_div_5_Template, 6, 5, \"div\", 4);\n      i0.ɵɵtemplate(6, PlaceEditComponent_div_6_Template, 3, 2, \"div\", 4);\n      i0.ɵɵtemplate(7, PlaceEditComponent_div_7_Template, 3, 2, \"div\", 4);\n      i0.ɵɵtemplate(8, PlaceEditComponent_div_8_Template, 3, 2, \"div\", 4);\n      i0.ɵɵelementStart(9, \"div\", 5);\n      i0.ɵɵelement(10, \"br\");\n      i0.ɵɵelementStart(11, \"button\", 6);\n      i0.ɵɵtext(12, \"Save\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"button\", 7);\n      i0.ɵɵlistener(\"click\", function PlaceEditComponent_Template_button_click_13_listener() {\n        return ctx.cancelOrDelete();\n      });\n      i0.ɵɵtext(14);\n      i0.ɵɵelementEnd()()()();\n    }\n\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(2);\n\n      i0.ɵɵproperty(\"options\", ctx.formSettings);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", !ctx.editMode);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.editMode);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.type === \"Country\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.type === \"State\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.type === \"City\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.type === \"Town\");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"disabled\", !_r0.valid);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(ctx.cancelDelete);\n    }\n  },\n  directives: [i3.MbscForm, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.NgForm, i5.NgIf, i3.MbscInput, i4.RequiredValidator, i4.NgControlStatus, i4.NgModel],\n  styles: [\".md-create-account[_ngcontent-%COMP%]{padding:0!important}.md-create-account[_ngcontent-%COMP%]   .md-cac-title[_ngcontent-%COMP%]{text-align:center;padding-bottom:3em}.md-create-account[_ngcontent-%COMP%]   .md-cac-title[_ngcontent-%COMP%], .md-create-account[_ngcontent-%COMP%]   .md-cac-cont[_ngcontent-%COMP%]{padding-top:0}.md-create-account[_ngcontent-%COMP%]   .md-cac-cont[_ngcontent-%COMP%]{padding:0;margin:0}.md-create-account[_ngcontent-%COMP%]   .md-chart-pic[_ngcontent-%COMP%]{background-image:url(/content/img/demos/chart@1x.png);height:150px;background-repeat:no-repeat;background-position:center}@media (-webkit-min-device-pixel-ratio: 2),(-webkit-min-device-pixel-ratio: 1.5),(min-resolution: 144dpi){.md-create-account[_ngcontent-%COMP%]   .md-chart-pic[_ngcontent-%COMP%]{background:url(/Content/img/demos/chart@2x.png) no-repeat center 12px;background-size:109px 81px;background-position:center}}.md-phone-num[_ngcontent-%COMP%]   .mbsc-np-dsp[_ngcontent-%COMP%]{min-height:25px;box-sizing:content-box}.loading-image[_ngcontent-%COMP%]{display:block;margin:0 auto}body[_ngcontent-%COMP%]   .ui-widget-overlay[_ngcontent-%COMP%]{background-color:#42424200}.loader[_ngcontent-%COMP%]{position:fixed;display:block;z-index:1009;background-color:#42424200;opacity:.7;top:0;left:0;width:100%;height:100%;border:3px solid rgb(247,243,243)}\"]\n});","map":null,"metadata":{},"sourceType":"script"}